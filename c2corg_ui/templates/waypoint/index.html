<%inherit file="../base.html"/>
<%namespace name="helpers" file="../helpers.html" import="add_pagination_links"/>
<%block name="pagetitle">Waypoints</%block>\
<%block name="metarobots"><meta name="robots" content="noindex,follow"></%block>\

<%block name="moduleConstantsValues">
% if len(waypoints):
module.value('mapFeatureCollection', {
  "type": "FeatureCollection",
  "properties": {
    "enableClickInteraction": true
  },
  "features": [
    <%
    from json import dumps, loads
    features = [];
    for waypoint in waypoints:
        if waypoint['geometry']['geom'] is not None:
            properties = {
               "module": "waypoints",
               "type":  waypoint['waypoint_type'],
               "documentId": waypoint['document_id'],
               "lang": waypoint['locales'][0]['culture'],
               "title": waypoint['locales'][0]['title'] + (
                " (" + waypoint['locales'][0]['culture'] + ")" if
                lang != waypoint['locales'][0]['culture'] else ""
               )
            }
            features.append(dumps({
                "type": "Feature",
                "geometry": loads(waypoint['geometry']['geom']),
                "properties": properties
            }))
    %>
    ${', '.join(features) | n}
  ]
});
% endif
</%block>\

<div class="text-center"><h3 ng-init="nbItems = ${total}">${self.pagetitle()} ({{nbItems}}) </h3></div class="text-center">


% if len(waypoints):
  <app-map></app-map>
% endif


<section id="waypoints_section">
 <div class="add_waypoint text-center">
         ${helpers.add_pagination_links('waypoints', waypoints, total, filter_params)}

     <button class='btn btn-lg btn-success '> <span class="glyphicon glyphicon-pushpin" aria-hidden="true"></span>
        <a  href="${request.route_url('waypoints_add')}" translate>Add a waypoint</a>
    </button>
 </div>

<div id="waypoints">
  <ul id="waypoints_list">
% for waypoint in waypoints:
  <% locale = waypoint['locales'][0] %>\
  <li onclick="location.href='${request.route_url('waypoints_view', id=waypoint['document_id'], culture=locale['culture'])}';" class="waypoint">
        <a class="waypoint_title " href="${request.route_url('waypoints_view', id=waypoint['document_id'], culture=locale['culture'])}">${locale['title']}</a>
       % if lang != locale['culture']:
       <span class="waypoint_culture"> (${locale['culture']})</span><br>
       % endif
       % if waypoint['elevation'] is not None:
       <div class="waypoint_info">
           <span class="waypoint_elevation">
               <img src="${request.static_url('c2corg_ui:static/img/icons/summit.png')}">
               ${waypoint['elevation']} m
           </span>
           <span>
               <img src="${request.static_url('c2corg_ui:static/img/icons/pass.png')}">
               <b translate>${waypoint['waypoint_type']}</b>
           </span>
       </div>
       % endif
       <p class="text-justify">Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text.</p>
  </li>
% endfor

</ul>
<div class="add_waypoint text-center">
    <button class='btn btn-lg btn-success '>
        <span class="glyphicon glyphicon-pushpin" aria-hidden="true"></span>
        <a  href="${request.route_url('waypoints_add')}" translate>Add a waypoint</a>
    </button>  
</div>
<div class="text-center">${helpers.add_pagination_links('waypoints', waypoints, total, filter_params)}</div>
</section>
