<%!
from c2corg_common.attributes import via_ferrata_ratings, default_langs, activities, route_types, \
    orientation_types, route_duration_types, glacier_gear_types, route_configuration_types, mtb_up_ratings, \
    ski_ratings, labande_ski_ratings, global_ratings, engagement_ratings, risk_ratings, ice_ratings, \
    mixed_ratings, aid_ratings, exposition_ratings, equipment_ratings, rock_types, hiking_ratings, \
    exposition_rock_ratings, climbing_outdoor_types, snowshoe_ratings,mtb_up_ratings, mtb_down_ratings, \
    climbing_ratings, slackline_types
%>
<%inherit file="../base.html"/>
<%
updating_doc = route_id and route_lang
%>
<%namespace file="../helpers/common.html" import="show_title"/>
<%namespace file="../helpers/edit.html" import="show_editing_associated_waypoints,
    show_editing_associated_routes, show_editing_associated_articles,
    show_editing_associated_books, show_preview_container, show_editing_buttons,
    show_save_confirmation_modal, show_protected_warning"/>
<%namespace file="../helpers/orientations.svg" import="show_orientations"/>

<%block name="pagetitle"><title ng-init="id=${route_id if route_id else 0}" ng-bind="id ? mainCtrl.page_title('Editing a route') : mainCtrl.page_title('Creating a route')">${show_title('Create/edit route')}</title></%block>

<%block name="metarobots"><meta name="robots" content="noindex,nofollow"></%block>

<section class="create-edit-document">

  <h1 ng-cloak ng-init="id=${route_id if route_id else 0}" ng-bind="id ? ('Editing a route' | translate) : ('Creating a route' | translate)" class="text-center"></h1>

  <form app-loading app-document-editing="routes" app-document-editing-model="route"
    app-document-editing-controller-name="appRouteEditingController"
  % if updating_doc:
    app-document-editing-id="${route_id}" app-document-editing-lang="${route_lang}"
  % endif
     name="editForm" novalidate ng-submit="editCtrl.confirmSave(editForm.$valid)" class="document-editing">

    <app-progress-bar>
      ## It won't work with ng-init
      <span class="ng-hide">{{progressBarCtrl.maxSteps = 3}} </span>

      ## PROGRESS BAR
      <ul class="progress-bar-edit">
        <li class="nav-step-1" ng-click="progressBarCtrl.step(1, 'route',  'backwards')" ng-class="{'nav-step-selected': progressBarCtrl.currentStep == 1 }"><span class="nav-text"><span translate>route</span> & <span translate>associations</span></span><span class="bullet-container"><span class="bullet"></span></span></li>
        <li class="nav-step-2" ng-click="progressBarCtrl.step(2, 'route', progressBarCtrl.previousStep >= 2 ? 'backwards' : 'forwards')"><span class="nav-text"><span translate>figures</span></span><span class="bullet-container"><span class="bullet"></span></span></li>
        <li class="nav-step-3" ng-click="progressBarCtrl.step(3, 'route', progressBarCtrl.previousStep >= 3 ? 'backwards' : 'forwards')"><span class="nav-text"><span translate>Comments</span></span></span><span class="bullet-container"><span class="bullet"></span></span></li>
      </ul>

      ## NAV BUTTONS
      <div class="nav-buttons">
        <button class="btn btn-primary prev" type="button" ng-if="progressBarCtrl.previousStep !== 0" ng-click="progressBarCtrl.step(progressBarCtrl.previousStep, 'route', 'backwards')"><span class="glyphicon glyphicon-triangle-left"></span></button>
        <button class="btn btn-primary next" type="button" ng-if="progressBarCtrl.nextStep <= progressBarCtrl.maxSteps" ng-click="progressBarCtrl.step(progressBarCtrl.nextStep, 'route', 'forwards')"><span class="glyphicon glyphicon-triangle-right"></span></button>
      </div>
    </app-progress-bar>

    ${show_protected_warning('route')}

    <section class="editing route">

      <div class="step step-1">

        <section class="section title">
          <h2 class="heading show-phone" translate>general informations</h2>

          <div class="content" id="title-edit">
            ## TITLE
          <div id="title-group" class="form-group"
               ng-class="{ 'has-feedback': editForm.title.$touched,
                           'has-error': editForm.title.$touched && editForm.title.$invalid,
                           'has-success': editForm.title.$touched && editForm.title.$valid }">
            <label ng-class="{ 'control-label': editForm.title.$touched && editForm.title.$invalid }"><span translate>title</span> *</label>
            <span uib-tooltip="{{mainCtrl.translate('main waypoint title')}}"/><input type="text" name="main_waypoint_title"
              ng-model="route.main_waypoint_title" ng-show="route.main_waypoint_title" class="form-control" disabled></span>
            <input type="text" name="title" ng-model="route.locales[0].title" ng-minlength="3" class="form-control" required />
            <span class="glyphicon glyphicon-ok form-control-feedback" ng-show="editForm.title.$valid"></span>
            <span class="glyphicon glyphicon-warning-sign form-control-feedback" ng-show="editForm.title.$invalid && editForm.title.$touched"></span>
            <div class="help-block" ng-messages="editForm.title.$error" ng-if="editForm.title.$invalid && editForm.title.$touched">
              <p ng-message="required" translate>This field is required.</p>
              <p ng-message="minlength" translate>Title must have at least 3 characters.</p>
            </div>
          </div>

            ## LANGUAGE
            <div id="lang-group" class="form-group"
                 ng-class="{ 'has-feedback': editForm.lang.$touched,
                             'has-error': editForm.lang.$touched && editForm.lang.$invalid,
                             'has-success': editForm.lang.$valid}">
              <label ng-class="{ 'control-label': editForm.lang.$touched && editForm.lang.$invalid }"><span translate>lang</span> *</label>
              % if route_lang:
                <input disabled class="form-control" value="{{mainCtrl.translate('${route_lang}')}}">
              % else:
                <select name="lang" ng-options="lang as mainCtrl.translate(lang) for lang in ['${"','".join(default_langs) |n}'] | translate" ng-model="route.locales[0].lang" class="form-control" required><option value=""></option></select>
              % endif
                <span class="glyphicon glyphicon-ok form-control-feedback" ng-show="route.locales[0].lang"></span>
              <span class="glyphicon glyphicon-warning-sign form-control-feedback" ng-show="editForm.lang.$touched && editForm.lang.$invalid"></span>
              <div class="help-block" ng-messages="editForm.lang.$error" ng-if="editForm.lang.$touched && editForm.lang.$invalid">
                <p ng-message="required" translate>This field is required.</p>
              </div>
            </div>

            ## MAP + upload
            <div class="full form-group">
              <label translate>Track</label>
              <div class="track">
                <app-gpx-upload></app-gpx-upload>
                <div class="track-tip" translate>You may also drag, draw or edit the track on the map.</div>
              </div>
              <app-map app-map-edit="true" app-map-show-recenter-tools="true" app-map-draw-type="LineString" class="map-edit"></app-map>
            </div>

          </div>
        </section>

        <section class="section associations">
          <h2 class="heading show-phone"><span translate>associations</span></h2>
          <h5 class="full" translate ng-show="editCtrl.documentService.document.associations.routes.length == 0 && editCtrl.documentService.document.associations.waypoints.length == 0">
            You can add associated routes and waypoints by searching in the field.
          </h5>
          <div class="content">
            ## wr = waypoints, routes
            <app-simple-search parent-id="route.document_id"
              app-select="editCtrl.documentService.pushToAssociations(doc, null, false, true)" dataset="wrcb"></app-simple-search>
            ${show_editing_associated_waypoints('route')}
            ${show_editing_associated_routes('route')}
            ${show_editing_associated_articles('route')}
            ${show_editing_associated_books('route')}
          </div>
        </section>

      </div>

      <div class="step step-2">
        <section class="section">
          <h2 class="heading show-phone" translate>activities</h2>
          <div class="content">

            ## ACTIVITIES
            <div class="form-group data full" id="route-activities" ng-init="activities = ${activities}">
              <label><span translate>activities</span> *</label>
              <div class="route-activities">
                <div ng-repeat="activity in activities" class="activity" ng-if="activity !== 'paragliding' ">
                  <div>
                    <div class="icon-{{activity}}" class="icon-" ng-click="editCtrl.pushToArray(route, 'activities', activity, $event)"
                         ng-class="{'activity-selected' : route.activities.indexOf(activity) > -1}">
                    </div>
                    <p>{{activity | translate}}</p>
                  </div>
                </div>
              </div>
            </div>

            ## CLIMBING OUTDOOR TYPE
            <div ng-if="route.activities.indexOf('rock_climbing') > -1" class="form-group data half">
              <label translate>climbing_outdoor_type</label>
              <select class="form-control" ng-model="route.climbing_outdoor_type" ng-options="type as mainCtrl.translate(type) for type in ${climbing_outdoor_types}"><option value=""></option></select>
              <span class="glyphicon glyphicon-ok form-control-feedback" ng-show="route.climbing_outdoor_type"></span>
            </div>

          </div>
        </section>

        <section class="section slacklining" ng-if="editCtrl.hasActivity(['slacklining'])">
          <h2 class="heading show-phone"><span translate>slacklining</span></h2>
          <div class="content" id="numbers-edit">

            ## LENGTH
            <div id="route_length-group" class="data half form-group" ng-class="{ 'has-error': editForm.route_length.$touched && editForm.route_length.$invalid,'has-success': route.route_length }">
              <label translate>length</label>
              <div class="input-group">
                <input type="number" min="0" minlength="1" name="route_length" ng-model="route.route_length" class="form-control" />
                <span class="input-group-addon">m</span>
              </div>
              <span class="glyphicon glyphicon-ok form-control-feedback" ng-show="route.route_length"></span>
              <span class="glyphicon glyphicon-warning-sign form-control-feedback" ng-show="editForm.route_length.$invalid && editForm.route_length.$touched"></span>
              <div class="help-block" ng-messages="editForm.route_length.$error">
                <p ng-message="number" class="label label-danger" style="{{ (editForm.route_length.$invalid && editForm.route_length.$touched) ? 'display:inline' : '' }}" translate>This field must be a number.</p>
              </div>
            </div>

            ## HEIGHT
            <div id="route_slackline_height-group" class="data half form-group" ng-class="{ 'has-error': editForm.slackline_height.$touched && editForm.slackline_height.$invalid,'has-success': route.slackline_height }">
              <label translate>height</label>
              <div class="input-group">
                <input type="number" min="0" minlength="1" name="slackline_height" ng-model="route.slackline_height" class="form-control" />
                <span class="input-group-addon">m</span>
              </div>
              <span class="glyphicon glyphicon-ok form-control-feedback" ng-show="route.slackline_height"></span>
              <span class="glyphicon glyphicon-warning-sign form-control-feedback" ng-show="editForm.slackline_height.$invalid && editForm.slackline_height.$touched"></span>
              <div class="help-block" ng-messages="editForm.slackline_height.$error">
                <p ng-message="number" class="label label-danger" style="{{ (editForm.route_length.$invalid && editForm.route_length.$touched) ? 'display:inline' : '' }}" translate>This field must be a number.</p>
              </div>
            </div>

            ## SLACKLINING TYPE
            <div class="form-group data half" ng-class="{ 'has-success': route.slackline_type}">
              <label translate>Type</label>
              <select class="form-control" ng-model="route.slackline_type" ng-options="type as mainCtrl.translate(type) for type in ${slackline_types}"><option value=""></option></select>
              <span class="glyphicon glyphicon-ok form-control-feedback" ng-show="route.slackline_type"></span>
            </div>

          </div>
        </section>

        <section class="section">
          <h2 class="heading show-phone" translate>configuration</h2>
          <div class="content configuration">

            ## ORIENTATION
            <div class="form-group data half">
              <label><span translate>orientations</span></label>
              ${show_orientations('editCtrl', 'route')}
            </div>

            <div class="form-group data half">

              ## ROUTE TYPES
              <label translate>route_types</label>
              <ul class="types">
                <li ng-repeat="type in ${route_types}" ng-click="editCtrl.pushToArray(route, 'route_types', type, $event)">
                  <div class="checkbox"><input type="checkbox" ng-checked="route.route_types.indexOf(type) > -1"><span>{{type | translate}}</span></div>
                </li>
              </ul>

              ## CONFIGURATION TYPES
              <div  ng-if="route.activities.indexOf('skitouring') > -1 || route.activities.indexOf('snow_ice_mixed') > -1
                  || route.activities.indexOf('mountain_climbing') > -1  || route.activities.indexOf('rock_climbing') > -1
                  || route.activities.indexOf('snowshoeing') > -1 || route.activities.indexOf('via_ferrata') > -1" class="form-group" adsd>
                <label translate>route_configuration_types</label>
                <ul class="types">
                  <li ng-repeat="type in ${route_configuration_types}" ng-click="editCtrl.pushToArray(route, 'configuration', type, $event)">
                    <div class="checkbox"><input type="checkbox" ng-checked="route.configuration.indexOf(type) > -1"><span>{{type | translate}}</span></div>
                  </li>
                </ul>
              </div>

            </div>

            ## ROCK TYPES
            <div class="form-group data half" ng-if="route.activities.indexOf('snow_ice_mixed') > -1 || route.activities.indexOf('mountain_climbing') > -1 || route.activities.indexOf('rock_climbing') > -1 || route.activities.indexOf('via_ferrata') > -1">
              <label translate>rock_types</label>
              <ul class="types long">
                <li ng-repeat="type in ${rock_types}" ng-click="editCtrl.pushToArray(route, 'rock_types', type, $event)">
                  <div class="checkbox"><input type="checkbox" ng-checked="route.rock_types.indexOf(type) > -1"><span>{{type | translate}}</span></div>
                </li>
              </ul>
            </div>

          </div>
        </section>

        <section class="section numbers">
          <h2 class="heading show-phone"><span translate>numbers</span></h2>
          <div class="content" id="numbers-edit">

            ## ELEVATION MIN
            <div id="elevation_min-group" class="data half form-group"
                 ng-class="{ 'has-feedback': editForm.elevation_min.$touched,
                             'has-error': editForm.elevation_min.$touched && editForm.elevation_min.$invalid,
                             'has-success': route.elevation_min }">
              <label ng-class="{ 'control-label': editForm.elevation_min.$touched && editForm.elevation_min.$invalid }" translate>elevation_min</label>
              <div class="input-group">
                <input type="number" min="0" max="9999" minlength="1" name="elevation_min" ng-model="route.elevation_min" class="form-control" />
                <span class="input-group-addon">m</span>
              </div>
              <span class="glyphicon glyphicon-ok form-control-feedback" ng-show="route.elevation_min"></span>
              <span class="glyphicon glyphicon-warning-sign form-control-feedback" ng-show="editForm.elevation_min.$touched && editForm.elevation_min.$invalid"></span>
              <div class="help-block" ng-messages="editForm.elevation_min.$error" ng-if="editForm.elevation_min.$touched && editForm.elevation_min.$invalid">
                <p ng-message="max" translate>This field must be lower than 9999 m.</p>
                <p ng-message="number" translate>This field must be a number.</p>
              </div>
            </div>

            ## ELEVATION MAX
            <div id="elevation_max-group" class="data half form-group"
                 ng-class="{ 'has-feedback': editForm.elevation_max.$touched,
                             'has-error': editForm.elevation_max.$touched && editForm.elevation_max.$invalid,
                             'has-success': route.elevation_max }">
              <label ng-class="{ 'control-label': editForm.elevation_max.$touched && editForm.elevation_max.$invalid }" translate>elevation_max</label>
              <div class="input-group">
                <input type="number" min="0" max="9999" minlength="1" name="elevation_max" ng-model="route.elevation_max" class="form-control" />
                <span class="input-group-addon">m</span>
              </div>
              <span class="glyphicon glyphicon-ok form-control-feedback" ng-show="route.elevation_max"></span>
              <span class="glyphicon glyphicon-warning-sign form-control-feedback" ng-show="editForm.elevation_max.$touched && editForm.elevation_max.$invalid"></span>
              <div class="help-block" ng-messages="editForm.elevation_max.$error" ng-if="editForm.elevation_max.$touched && editForm.elevation_max.$invalid">
                <p ng-message="max" translate>This field must be lower than 9999 m.</p>
                <p ng-message="number" translate>This field must be a number.</p>
              </div>
            </div>

            ## HEIGHT DIFF UP
            <div id="height_diff_up-group" class="data half form-group"
                 ng-class="{ 'has-feedback': editForm.height_diff_up.$touched,
                             'has-error': editForm.height_diff_up.$touched && editForm.height_diff_up.$invalid,
                             'has-success': route.height_diff_up }">
              <label ng-class="{ 'control-label': editForm.height_diff_up.$touched && editForm.height_diff_up.$invalid }" translate>height_diff_up</label>
              <div class="input-group">
                <input type="number" min="0" name="height_diff_up" ng-model="route.height_diff_up" class="form-control" />
                <span class="input-group-addon">m</span>
              </div>
              <span class="glyphicon glyphicon-ok form-control-feedback" ng-show="route.height_diff_up"></span>
              <span class="glyphicon glyphicon-warning-sign form-control-feedback" ng-show="editForm.height_diff_up.$invalid && editForm.height_diff_up.$touched"></span>
              <div class="help-block" ng-messages="editForm.height_diff_up.$error" ng-if="editForm.height_diff_up.$touched && editForm.height_diff_up.$invalid">
                <p ng-message="number" translate>This field must be a number.</p>
              </div>
            </div>

            ## HEIGHT DIFF DOWN
            <div id="height_diff_down-group" class="data half form-group"
                 ng-class="{ 'has-feedback': editForm.height_diff_down.$touched,
                             'has-error': editForm.height_diff_down.$touched && editForm.height_diff_down.$invalid,
                             'has-success': route.height_diff_down }">
              <label ng-class="{ 'control-label': editForm.height_diff_down.$touched && editForm.height_diff_down.$invalid }" translate>height_diff_down</label>
              <div class="input-group">
                <input type="number" min="0" name="height_diff_down" ng-model="route.height_diff_down" class="form-control" />
                <span class="input-group-addon">m</span>
              </div>
              <span class="glyphicon glyphicon-ok form-control-feedback" ng-show="route.height_diff_down"></span>
              <span class="glyphicon glyphicon-warning-sign form-control-feedback" ng-show="editForm.height_diff_down.$invalid && editForm.height_diff_down.$touched"></span>
              <div class="help-block" ng-messages="editForm.height_diff_down.$error" ng-if="editForm.height_diff_down.$touched && editForm.height_diff_down.$invalid">
                <p ng-message="number" translate>This field must be a number.</p>
              </div>
            </div>

            ## HEIGHT DIFF ACCESS
            <div id="height_diff_access-group" class="data half form-group"
                 ng-class="{ 'has-feedback': editForm.height_diff_access.$touched,
                             'has-error': editForm.height_diff_access.$touched && editForm.height_diff_access.$invalid,
                             'has-success': route.height_diff_access }">
              <label ng-class="{ 'control-label': editForm.height_diff_access.$touched && editForm.height_diff_access.$invalid }" translate>height_diff_access</label>
              <div class="input-group">
                <input type="number" min="0" name="height_diff_access" ng-model="route.height_diff_access" class="form-control" />
                <span class="input-group-addon">m</span>
              </div>
              <span class="glyphicon glyphicon-ok form-control-feedback" ng-show="route.height_diff_access"></span>
              <span class="glyphicon glyphicon-warning-sign form-control-feedback" ng-show="editForm.height_diff_access.$invalid && editForm.height_diff_access.$touched"></span>
              <div class="help-block" ng-messages="editForm.height_diff_access.$error" ng-if="editForm.height_diff_access.$touched && editForm.height_diff_access.$invalid">
                <p ng-message="number" translate>This field must be a number.</p>
              </div>
            </div>

            ## HEIGHT DIFF DIFFICULTIES
            <div id="height_diff_difficulties-group" class="data half form-group"
                 ng-class="{ 'has-feedback': editForm.height_diff_difficulties.$touched,
                             'has-error': editForm.height_diff_difficulties.$touched && editForm.height_diff_difficulties.$invalid,
                             'has-success': route.height_diff_difficulties }">
              <label ng-class="{ 'control-label': editForm.height_diff_difficulties.$touched && editForm.height_diff_difficulties.$invalid }" translate>height_diff_difficulties</label>
              <div class="input-group">
                <input type="number" min="0" name="height_diff_difficulties" ng-model="route.height_diff_difficulties" class="form-control" />
                <span class="input-group-addon">m</span>
              </div>
              <span class="glyphicon glyphicon-ok form-control-feedback" ng-show="route.height_diff_difficulties"></span>
              <span class="glyphicon glyphicon-warning-sign form-control-feedback" ng-show="editForm.height_diff_difficulties.$invalid && editForm.height_diff_difficulties.$touched"></span>
              <div class="help-block" ng-messages="editForm.height_diff_difficulties.$error" ng-if="editForm.height_diff_difficulties.$touched && editForm.height_diff_difficulties.$invalid">
                <p ng-message="number" translate>This field must be a number.</p>
              </div>
            </div>

            ## DIFFICULTIES HEIGHT
            <div id="difficulties_height-group" class="data half form-group"
                 ng-class="{ 'has-feedback': editForm.difficulties_height.$touched,
                             'has-error': editForm.difficulties_height.$touched && editForm.difficulties_height.$invalid,
                             'has-success': route.difficulties_height }"
                 ng-if="route.activities.indexOf('via_ferrata') > -1 || route.activities.indexOf('ice_climbing') > -1 || route.activities.indexOf('rock_climbing') > -1 || route.activities.indexOf('mountain_climbing') > -1 || route.activities.indexOf('snow_ice_mixed') > -1">
              <label ng-class="{ 'control-label': editForm.difficulties_height.$touched && editForm.difficulties_height.$invalid }" translate>difficulties_height</label>
              <div class="input-group">
                <input type="number" min="0" max="9999" name="difficulties_height" ng-model="route.difficulties_height" class="form-control" />
                <span class="input-group-addon">m</span>
              </div>
              <span class="glyphicon glyphicon-ok form-control-feedback" ng-show="route.difficulties_height"></span>
              <span class="glyphicon glyphicon-warning-sign form-control-feedback" ng-show="editForm.difficulties_height.$invalid && editForm.difficulties_height.$touched"></span>
              <div class="help-block" ng-messages="editForm.difficulties_height.$error" ng-if="editForm.difficulties_height.$touched && editForm.difficulties_height.$invalid">
                <p ng-message="max" translate>This field must be lower than 9999 m.</p>
                <p ng-message="number" translate>This field must be a number.</p>
              </div>
            </div>

            ## ROUTE LENGTH
            <div id="route_length-group" class="data half form-group"
                 ng-class="{ 'has-feedback': editForm.route_length.$touched,
                             'has-error': editForm.route_length.$touched && editForm.route_length.$invalid,
                             'has-success': route.route_length }"
                 ng-if="editCtrl.hasActivity(['skitouring', 'snow_ice_mixed', 'hiking', 'snowshoeing', 'via_ferrata', 'mountain_biking', 'mountain_climbing', 'slacklining'])">
              <label ng-class="{ 'control-label': editForm.route_length.$touched && editForm.route_length.$invalid }" translate>route_length</label>
              <div class="input-group">
                <input type="number" min="0" minlength="1" name="route_length"
                       ng-model="route.route_length" app-length-converter
                       class="form-control" />
                <span class="input-group-addon">km</span>
              </div>
              <span class="glyphicon glyphicon-ok form-control-feedback" ng-show="route.route_length"></span>
              <span class="glyphicon glyphicon-warning-sign form-control-feedback" ng-show="editForm.route_length.$invalid && editForm.route_length.$touched"></span>
              <div class="help-block" ng-messages="editForm.route_length.$error" ng-if="editForm.route_length.$touched && editForm.route_length.$invalid">
                <p ng-message="number" translate>This field must be a number.</p>
              </div>
            </div>

           ## MTB LENGTH ASPHALT
            <div id="mtb_length_asphalt-group" class="data half form-group"
                 ng-class="{ 'has-feedback': editForm.mtb_length_asphalt.$touched,
                             'has-error': editForm.mtb_length_asphalt.$touched && editForm.mtb_length_asphalt.$invalid,
                             'has-success': route.mtb_length_asphalt }"
                 ng-if="route.activities.indexOf('mountain_biking') > -1">
              <label ng-class="{ 'control-label': editForm.mtb_length_asphalt.$touched && editForm.mtb_length_asphalt.$invalid }" translate>mtb_length_asphalt</label>
              <div class="input-group">
                <input type="number" min="0" minlength="1" name="mtb_length_asphalt"
                       ng-model="route.mtb_length_asphalt" app-length-converter
                       class="form-control" />
                <span class="input-group-addon">km</span>
              </div>
              <span class="glyphicon glyphicon-ok form-control-feedback" ng-show="route.mtb_length_asphalt"></span>
              <span class="glyphicon glyphicon-warning-sign form-control-feedback" ng-show="editForm.mtb_length_asphalt.$invalid && editForm.mtb_length_asphalt.$touched"></span>
              <div class="help-block" ng-messages="editForm.mtb_length_asphalt.$error" ng-if="editForm.mtb_length_asphalt.$touched && editForm.mtb_length_asphalt.$invalid">
                <p ng-message="number" translate>This field must be a number.</p>
              </div>
            </div>

            ## MTB LENGTH TRAIL
            <div id="mtb_length_trail-group" class="data half form-group"
                 ng-class="{ 'has-feedback': editForm.mtb_length_trail.$touched,
                             'has-error': editForm.mtb_length_trail.$touched && editForm.mtb_length_trail.$invalid,
                             'has-success': route.mtb_length_trail }"
                 ng-if="route.activities.indexOf('mountain_biking') > -1">
              <label ng-class="{ 'control-label': editForm.mtb_length_trail.$touched && editForm.mtb_length_trail.$invalid }" translate>mtb_length_trail</label>
              <div class="input-group">
                <input type="number" min="0" minlength="1" name="mtb_length_trail"
                       ng-model="route.mtb_length_trail" app-length-converter
                       class="form-control" />
                <span class="input-group-addon">km</span>
              </div>
              <span class="glyphicon glyphicon-ok form-control-feedback" ng-show="route.mtb_length_trail"></span>
              <span class="glyphicon glyphicon-warning-sign form-control-feedback" ng-show="editForm.mtb_length_trail.$invalid && editForm.mtb_length_trail.$touched"></span>
              <div class="help-block" ng-messages="editForm.mtb_length_trail.$error" ng-if="editForm.mtb_length_trail.$touched && editForm.mtb_length_trail.$invalid">
                <p ng-message="number" translate>This field must be a number.</p>
              </div>
            </div>

            ## MTB HEIGHT DIFF PORTAGES
            <div id="mtb_height_diff_portages-group" class="data half form-group"
                 ng-class="{ 'has-feedback': editForm.mtb_height_diff_portages.$touched,
                             'has-error': editForm.mtb_height_diff_portages.$touched && editForm.mtb_height_diff_portages.$invalid,
                             'has-success': route.mtb_height_diff_portages }"
                 ng-if="route.activities.indexOf('mountain_biking') > -1">
              <label ng-class="{ 'control-label': editForm.mtb_height_diff_portages.$touched && editForm.mtb_height_diff_portages.$invalid }" translate>mtb_height_diff_portages</label>
              <div class="input-group">
                <input type="number" min="0" minlength="1" name="mtb_height_diff_portages" ng-model="route.mtb_height_diff_portages" class="form-control" />
                <span class="input-group-addon">m</span>
              </div>
              <span class="glyphicon glyphicon-ok form-control-feedback" ng-show="route.mtb_height_diff_portages"></span>
              <span class="glyphicon glyphicon-warning-sign form-control-feedback" ng-show="editForm.mtb_height_diff_portages.$invalid && editForm.mtb_height_diff_portages.$touched"></span>
              <div class="help-block" ng-messages="editForm.mtb_height_diff_portages.$error" ng-if="editForm.mtb_height_diff_portages.$touched && editForm.mtb_height_diff_portages.$invalid">
                <p ng-message="number" translate>This field must be a number.</p>
              </div>
            </div>

            ## DURATIONS
            <div class="form-group data half" ng-class="{ 'has-success': route.durations}">
              <label><span translate>durations</span> (<span translate>days</span>)</span></label>
              <ul class="types">
                <li ng-repeat="type in ${route_duration_types}" ng-click="editCtrl.pushToArray(route, 'durations', type, $event)">
                  <div class="checkbox"><input type="checkbox" ng-checked="route.durations.indexOf(type) > -1"><span>{{type | translate}}</span></div>
                </li>
              </ul>
            </div>

            ## LIFT ACCESS
            <div class="form-group data half" ng-class="{ 'has-success': route.lift_access }">
              <label translate>lift_access</label>
              <div class="input-group">
               <select class="form-control" ng-model="route.lift_access">
                  <option value="true" ng-selected="route.lift_access == true" translate>yes</option>
                  <option value="false" ng-selected="route.lift_access == false" translate>no</option>
                  <option value="" translate>no info</option>
                </select>
                <span class="input-group-addon"><span class="glyphicon glyphicon-resize-vertical"></span></span>
              </div>

              <span class="glyphicon glyphicon-ok form-control-feedback" ng-show="route.lift_access"></span>
            </div>

          </div>
        </section>

        <section class="section ratings" ng-if="editCtrl.showRatings()">
          <h2 class="heading show-phone" translate>ratings</h2>
          <div class="content" id="rating-edit">

            ## SKI RATING
            <div class="form-group data half" ng-class="{ 'has-success': route.ski_rating}" ng-if="route.activities.indexOf('skitouring') > -1">
              <label translate>ski_rating</label>
              <div class="input-group">
                <select class="form-control" ng-model="route.ski_rating" ng-options="rat as rat for rat in ${ski_ratings}"><option value=""></option></select>
                <span class="input-group-addon"><span class="glyphicon glyphicon-star"></span></span>
              </div>
              <span class="glyphicon glyphicon-ok form-control-feedback" ng-show="route.ski_rating"></span>
            </div>

            ## LABANDE SKI RATING
            <div class="form-group data half" ng-class="{ 'has-success': route.labande_ski_rating}" ng-if="route.activities.indexOf('skitouring') > -1">
              <label translate>labande_ski_rating</label>
              <div class="input-group">
                <select class="form-control" ng-model="route.labande_ski_rating" ng-options="rat as rat for rat in ${labande_ski_ratings}"><option value=""></option></select>
                <span class="input-group-addon"><span class="glyphicon glyphicon-star"></span></span>
              </div>
              <span class="glyphicon glyphicon-ok form-control-feedback" ng-show="route.labande_ski_rating"></span>
            </div>

            ## LABANDE GLOBAL  RATING
            <div class="form-group data half" ng-class="{ 'has-success': route.labande_global_rating}" ng-if="route.activities.indexOf('skitouring') > -1">
              <label translate>labande_global_rating</label>
              <div class="input-group">
                <select class="form-control" ng-model="route.labande_global_rating" ng-options="rat as rat for rat in ${global_ratings}"><option value=""></option></select>
                <span class="input-group-addon"><span class="glyphicon glyphicon-star"></span></span>
              </div>
              <span class="glyphicon glyphicon-ok form-control-feedback" ng-show="route.labande_global_rating"></span>
            </div>

            ## SNOWSHOE  RATING
            <div class="form-group data half" ng-class="{ 'has-success': route.snowshoe_rating}" ng-if="route.activities.indexOf('snowshoeing') > -1">
              <label translate>snowshoe_rating</label>
              <div class="input-group">
                <select class="form-control" ng-model="route.snowshoe_rating" ng-options="rat as rat for rat in ${snowshoe_ratings}"><option value=""></option></select>
                <span class="input-group-addon"><span class="glyphicon glyphicon-star"></span></span>
              </div>
              <span class="glyphicon glyphicon-ok form-control-feedback" ng-show="route.snowshoe_rating"></span>
            </div>

            ## GLOBAL  RATING
            <div class="form-group data half" ng-class="{ 'has-success': route.global_rating}" ng-if="route.activities.indexOf('snow_ice_mixed') > -1 || route.activities.indexOf('mountain_climbing') > -1 || route.activities.indexOf('rock_climbing') > -1 || route.activities.indexOf('ice_climbing') > -1">
              <label translate>global_rating</label>
              <div class="input-group">
                <select class="form-control" ng-model="route.global_rating" ng-options="rat as rat for rat in ${global_ratings}"><option value=""></option></select>
                <span class="input-group-addon"><span class="glyphicon glyphicon-star"></span></span>
              </div>
              <span class="glyphicon glyphicon-ok form-control-feedback" ng-show="route.global_rating"></span>
            </div>

            ## ENGAGEMENT  RATING
            <div class="form-group data half" ng-class="{ 'has-success': route.engagement_rating}" ng-if="route.activities.indexOf('snow_ice_mixed') > -1 || route.activities.indexOf('mountain_climbing') > -1 || route.activities.indexOf('rock_climbing') > -1
                 || route.activities.indexOf('ice_climbing') > -1 || route.activities.indexOf('via_ferrata') > -1">
              <label translate>engagement_rating</label>
              <div class="input-group">
                <select class="form-control" ng-model="route.engagement_rating" ng-options="rat as rat for rat in ${engagement_ratings}"><option value=""></option></select>
                <span class="input-group-addon"><span class="glyphicon glyphicon-star"></span></span>
              </div>
              <span class="glyphicon glyphicon-ok form-control-feedback" ng-show="route.engagement_rating"></span>
            </div>

            ## EQUIPMENT  RATING
            <div class="form-group data half" ng-class="{ 'has-success': route.equipment_rating}" ng-if="route.activities.indexOf('snow_ice_mixed') > -1 || route.activities.indexOf('mountain_climbing') > -1 || route.activities.indexOf('rock_climbing') > -1 || route.activities.indexOf('ice_climbing') > -1 || route.activities.indexOf('via_ferrata') > -1">
              <label translate>equipment_rating</label>
              <div class="input-group">
                <select class="form-control" ng-model="route.equipment_rating" ng-options="rat as rat for rat in ${equipment_ratings}"><option value=""></option></select>
                <span class="input-group-addon"><span class="glyphicon glyphicon-star"></span></span>
              </div>
              <span class="glyphicon glyphicon-ok form-control-feedback" ng-show="route.equipment_rating"></span>
            </div>

            ## ICE  RATING
            <div class="form-group data half" ng-class="{ 'has-success': route.ice_rating}" ng-if="route.activities.indexOf('snow_ice_mixed') > -1 || route.activities.indexOf('ice_climbing') > -1">
              <label translate>ice_rating</label>
              <div class="input-group">
                <select class="form-control" ng-model="route.ice_rating" ng-options="rat as rat for rat in ${ice_ratings}"><option value=""></option></select>
                <span class="input-group-addon"><span class="glyphicon glyphicon-star"></span></span>
              </div>
              <span class="glyphicon glyphicon-ok form-control-feedback" ng-show="route.ice_rating"></span>
            </div>

            ## MIXED  RATING
            <div class="form-group data half" ng-class="{ 'has-success': route.mixed_rating}" ng-if="route.activities.indexOf('snow_ice_mixed') > -1 || route.activities.indexOf('ice_climbing') > -1">
              <label translate>mixed_rating</label>
              <div class="input-group">
                <select class="form-control" ng-model="route.mixed_rating" ng-options="rat as rat for rat in ${mixed_ratings}"><option value=""></option></select>
                <span class="input-group-addon"><span class="glyphicon glyphicon-star"></span></span>
              </div>
              <span class="glyphicon glyphicon-ok form-control-feedback" ng-show="route.mixed_rating"></span>
            </div>

            ## RISK  RATING
            <div class="form-group data half" ng-class="{ 'has-success': route.risk_rating}" ng-if="route.activities.indexOf('snow_ice_mixed') > -1 || route.activities.indexOf('mountain_climbing') > -1 || route.activities.indexOf('rock_climbing') > -1 || route.activities.indexOf('ice_climbing') > -1">
              <label translate>risk_rating</label>
              <div class="input-group">
                <select class="form-control" ng-model="route.risk_rating" ng-options="rat as rat for rat in ${risk_ratings}"><option value=""></option></select>
                <span class="input-group-addon"><span class="glyphicon glyphicon-star"></span></span>
              </div>
              <span class="glyphicon glyphicon-ok form-control-feedback" ng-show="route.risk_rating"></span>
            </div>

            ## VIA FERRATA  RATING
            <div class="form-group data half" ng-class="{ 'has-success': route.via_ferrata_rating}" ng-if="route.activities.indexOf('via_ferrata') > -1">
              <label translate>via_ferrata_rating</label>
              <div class="input-group">
                <select class="form-control" ng-model="route.via_ferrata_rating" ng-options="rat as rat for rat in ${via_ferrata_ratings}"><option value=""></option></select>
                <span class="input-group-addon"><span class="glyphicon glyphicon-star"></span></span>
              </div>
              <span class="glyphicon glyphicon-ok form-control-feedback" ng-show="route.via_ferrata_rating"></span>
            </div>

            ## HIKING  RATING
            <div class="form-group data half" ng-class="{ 'has-success': route.hiking_rating}" ng-if="route.activities.indexOf('hiking') > -1">
              <label translate>hiking_rating</label>
              <div class="input-group">
                <select class="form-control" ng-model="route.hiking_rating" ng-options="rat as rat for rat in ${hiking_ratings}"><option value=""></option></select>
                <span class="input-group-addon"><span class="glyphicon glyphicon-star"></span></span>
              </div>
              <span class="glyphicon glyphicon-ok form-control-feedback" ng-show="route.hiking_rating"></span>
            </div>

            ## MTB DOWN  RATING
            <div class="form-group data half" ng-class="{ 'has-success': route.mtb_down_rating}" ng-if="route.activities.indexOf('mountain_biking') > -1">
              <label translate>mtb_down_rating</label>
              <div class="input-group">
                <select class="form-control" ng-model="route.mtb_down_rating" ng-options="rat as rat for rat in ${mtb_down_ratings}"><option value=""></option></select>
                <span class="input-group-addon"><span class="glyphicon glyphicon-star"></span></span>
              </div>
              <span class="glyphicon glyphicon-ok form-control-feedback" ng-show="route.mtb_down_rating"></span>
            </div>

            ## MTB UP  RATING
            <div class="form-group data half" ng-class="{ 'has-success': route.mtb_up_rating}" ng-if="route.activities.indexOf('mountain_biking') > -1">
              <label translate>mtb_up_rating</label>
              <div class="input-group">
                <select class="form-control" ng-model="route.mtb_up_rating" ng-options="rat as rat for rat in ${mtb_up_ratings}"><option value=""></option></select>
                <span class="input-group-addon"><span class="glyphicon glyphicon-star"></span></span>
              </div>
              <span class="glyphicon glyphicon-ok form-control-feedback" ng-show="route.mtb_up_rating"></span>
            </div>

            ## ROCK FREE  RATING
            <div class="form-group data half" ng-class="{ 'has-success': route.rock_free_rating}" ng-if="route.activities.indexOf('mountain_climbing') > -1 || route.activities.indexOf('rock_climbing') > -1">
              <label translate>rock_free_rating</label>
              <div class="input-group">
                <select class="form-control" ng-model="route.rock_free_rating" ng-options="rat as rat for rat in ${climbing_ratings}"><option value=""></option></select>
                <span class="input-group-addon"><span class="glyphicon glyphicon-star"></span></span>
              </div>
              <span class="glyphicon glyphicon-ok form-control-feedback" ng-show="route.rock_free_rating"></span>
            </div>

            ## ROCK EXPOSITION RATING
            <div class="form-group data half" ng-class="{ 'has-success': route.exposition_rock_rating}" ng-if="route.activities.indexOf('rock_climbing') > -1 || route.activities.indexOf('mountain_climbing') > -1">
              <label translate>exposition_rock_rating</label>
              <div class="input-group">
                <select class="form-control" ng-model="route.exposition_rock_rating" ng-options="rat as rat for rat in ${exposition_rock_ratings}"><option value=""></option></select>
                <span class="input-group-addon"><span class="glyphicon glyphicon-star"></span></span>
              </div>
              <span class="glyphicon glyphicon-ok form-control-feedback" ng-show="route.exposition_rock_rating"></span>
            </div>

            ## ROCK REQUIRED  RATING
            <div class="form-group data half" ng-class="{ 'has-success': route.rock_required_rating}" ng-if="route.activities.indexOf('mountain_climbing') > -1 || route.activities.indexOf('rock_climbing') > -1">
              <label translate>rock_required_rating</label>
              <div class="input-group">
                <select class="form-control" ng-model="route.rock_required_rating" ng-options="rat as rat for rat in ${climbing_ratings}"><option value=""></option></select>
                <span class="input-group-addon"><span class="glyphicon glyphicon-star"></span></span>
              </div>
              <span class="glyphicon glyphicon-ok form-control-feedback" ng-show="route.rock_required_rating"></span>
            </div>

            ## AID RATING
            <div class="form-group data half" ng-class="{ 'has-success': route.aid_rating}" ng-if="route.activities.indexOf('mountain_climbing') > -1 || route.activities.indexOf('rock_climbing') > -1">
              <label translate>aid_rating</label>
              <div class="input-group">
                <select class="form-control" ng-model="route.aid_rating" ng-options="rat as rat for rat in ${aid_ratings}"><option value=""></option></select>
                <span class="input-group-addon"><span class="glyphicon glyphicon-star"></span></span>
              </div>
              <span class="glyphicon glyphicon-ok form-control-feedback" ng-show="route.aid_rating"></span>
            </div>

            ## SKI EXPOSITION
            <div class="form-group data half" ng-if="route.activities.indexOf('skitouring') > -1" ng-class="{ 'has-success': route.ski_exposition}">
              <label translate>ski_exposition</label>
              <div class="input-group">
                <select class="form-control" ng-model="route.ski_exposition" ng-options="rat as mainCtrl.translate(rat) for rat in ${exposition_ratings}"><option value=""></option></select>
                <span class="input-group-addon"><span class="glyphicon glyphicon-resize-vertical"></span></span>
              </div>
              <span class="glyphicon glyphicon-ok form-control-feedback" ng-show="route.ski_exposition"></span>
            </div>

            ## HIKING MTB EXPOSITION
            <div class="form-group data half" ng-class="{ 'has-success': route.hiking_mtb_exposition}" ng-if="route.activities.indexOf('hiking') > -1 || route.activities.indexOf('mountain_biking') > -1">
              <label translate>hiking_mtb_exposition</label>
              <div class="input-group">
                <select class="form-control" ng-model="route.hiking_mtb_exposition" ng-options="rat as rat for rat in ${exposition_ratings}"><option value=""></option></select>
                <span class="input-group-addon"><span class="glyphicon glyphicon-resize-vertical"></span></span>
              </div>
              <span class="glyphicon glyphicon-ok form-control-feedback" ng-show="route.hiking_mtb_exposition"></span>
            </div>

            ## SLOPE
            <div id="slope-group" class="form-group data full" ng-class="{ 'has-success': route.locales[0].slope}"  ng-if="route.activities.indexOf('skitouring') > -1 || route.activities.indexOf('snow_ice_mixed') > -1  || route.activities.indexOf('ice_climbing') > -1 || route.activities.indexOf('snowshoeing') > -1">
              <label translate>slope</label>
              <input type="text" name="slope" ng-model="route.locales[0].slope" class="form-control">
            </div>

          </div>
        </section>
      </div>

      <div class="step step-3">
        <section class="section">
          <h2 class="heading show-phone" translate>Comments</h2>
          <div class="content">

            ## SUMMARY
            <div id="summary-group" class="form-group data full">
              <label translate>summary</label>
              <textarea app-markdown-editor name="summary" ng-model="route.locales[0].summary" class="form-control"></textarea>
            </div>

            ## DESCRIPTION
            <div id="description-group" class="form-group data full">
              <label translate>description</label>
              <textarea app-markdown-editor name="description" ng-model="route.locales[0].description" class="form-control description"></textarea>
            </div>

            ## Slackline Anchor 1
            <div id="slackline_anchor1-group" class="form-group data full" ng-if="editCtrl.hasActivity(['slacklining'])">
              <label translate>slackline_anchor1</label>
              <textarea app-markdown-editor name="slackline_anchor1" ng-model="route.locales[0].slackline_anchor1" class="form-control"></textarea>
            </div>

            ## Slackline Anchor 2
            <div id="slackline_anchor1-group" class="form-group data full" ng-if="editCtrl.hasActivity(['slacklining'])">
              <label translate>slackline_anchor2</label>
              <textarea app-markdown-editor name="slackline_anchor2" ng-model="route.locales[0].slackline_anchor2" class="form-control"></textarea>
            </div>

            ## REMARKS
            <div id="remarks-group" class="form-group data full">
              <label translate>remarks</label>
              <textarea app-markdown-editor name="remarks" ng-model="route.locales[0].remarks" class="form-control"></textarea>
            </div>

            ## ROUTE HISTORY
            <div class="form-group data full">
              <label translate>route_history</label>
              <textarea app-markdown-editor name="route_history" ng-model="route.locales[0].route_history" class="form-control"></textarea>
            </div>

            ## GEAR LOCALE
            <div id="gear-group" class="form-group data full">
              <label translate>specific gear</label>
              <textarea app-markdown-editor name="gear" ng-model="route.locales[0].gear" class="form-control" placeholder="{{'Describe here the gear needed for this route' | translate}}"></textarea>
            </div>

            ## GLACIER GEAR
            <div class="form-group data half" ng-class="{ 'has-success': route.glacier_gear }"
                 ng-if="route.activities.indexOf('skitouring') > -1 || route.activities.indexOf('snow_ice_mixed') > -1
                || route.activities.indexOf('mountain_climbing') > -1 || route.activities.indexOf('rock_climbing') > -1
                || route.activities.indexOf('ice_climbing') > -1  || route.activities.indexOf('snowshoeing') > -1
                || route.activities.indexOf('hiking') > -1">
              <label translate>glacier_gear</label>
              <select class="form-control" ng-model="route.glacier_gear" ng-options="rat as mainCtrl.translate(rat) for rat in ${glacier_gear_types}"><option value=""></option></select>
              <span class="glyphicon glyphicon-ok form-control-feedback" ng-show="route.glacier_gear"></span>
            </div>

            ## EXTERNAL RESOURCES
            <div class="form-group data full">
              <label translate>external_resources</label>
              <textarea app-markdown-editor name="external_resources" ng-model="route.locales[0].external_resources" class="form-control" placeholder="{{'Books and websites not already associated to this route' | translate}}"></textarea>
            </div>

          </div>
        </section>
      </div>

      ${show_editing_buttons('route', updating_doc, route_id, route_lang)}

    </section>
  </form>

  ${show_preview_container()}
  ${show_save_confirmation_modal(updating_doc)}
</section>
